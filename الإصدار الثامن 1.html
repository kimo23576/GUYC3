<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>النظام الملكي لحساب الأضرار والخسائر</title>
  <!-- استدعاء Font Awesome والخطوط -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- مكتبة jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* إعدادات الألوان والخطوط الفاخرة */
    :root {
      --primary-color: #2E1A47;         /* أرجواني داكن */
      --secondary-color: #4B306A;       /* بنفسجي ملكي */
      --accent-color: #D4AF37;          /* ذهبي فاخر */
      --info-color: #00A1E4;
      --bg-color: #F3E8C9;              /* لون فاتح دافئ */
      --section-bg: rgba(255, 255, 255, 0.95);
      --section-border: var(--accent-color);
      --text-color: #2E1A47;
      --animation-speed: 0.6s;
    }
    /* تأثير فقاعات خلفية */
    body {
      background: var(--bg-color);
      overflow-x: hidden;
      position: relative;
      padding-bottom: 80px;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(212,175,55,0.15), transparent 70%);
      z-index: -2;
      animation: moveBubbles 20s linear infinite;
    }
    @keyframes moveBubbles {
      0% { transform: translate(0, 0); }
      50% { transform: translate(50px, -50px); }
      100% { transform: translate(0, 0); }
    }
    /* استخدام الخط الملكي */
    * { font-family: 'Noto Naskh Arabic', serif; margin: 0; padding: 0; box-sizing: border-box; }
    .container {
      width: 90%;
      max-width: 1400px;
      margin: 40px auto;
      padding: 30px;
      background: var(--section-bg);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      position: relative;
      overflow: hidden;
    }
    /* الهيدر الفاخر */
    .header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: #FFD700;
      padding: 3rem 2rem;
      text-align: center;
      border-radius: 20px;
      margin-bottom: 2.5rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      animation: slideIn var(--animation-speed) ease-out;
    }
    .header::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 10px;
      background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
      animation: glow 3s infinite;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes glow {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    .header h1 { font-size: 3rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.4); }
    .header h2 { font-size: 1.6rem; margin-bottom: 1rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }
    .header a { color: var(--accent-color); text-decoration: none; font-weight: bold; }
    .reference-number {
      background: var(--accent-color);
      padding: 1rem 2rem;
      border-radius: 25px;
      margin-top: 1.5rem;
      display: inline-block;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    /* الأقسام الفاخرة */
    .section {
      background: var(--section-bg);
      border-radius: 15px;
      padding: 2.5rem;
      margin-bottom: 2rem;
      border: 3px double var(--accent-color);
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.8s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
    .section-title {
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 1.8rem;
      position: relative;
      padding-bottom: 5px;
      border-bottom: 2px solid var(--accent-color);
    }
    .section-title i { font-size: 2rem; }
    .section-intro {
      background: #FFF;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      border-left: 6px solid var(--accent-color);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
    }
    .input-group { margin-bottom: 2rem; }
    label { margin-bottom: 0.5rem; font-weight: bold; color: var(--primary-color); }
    input, select, textarea {
      width: 100%;
      padding: 1rem;
      border: 2px solid #DDD;
      border-radius: 8px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--accent-color); outline: none; }
    .dynamic-list { margin: 1.5rem 0; }
    .item-card {
      background: #FFF;
      border: 2px solid #EEE;
      padding: 1.5rem;
      margin: 1rem 0;
      border-radius: 10px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      align-items: center;
      position: relative;
      animation: fadeIn 0.8s ease-out;
    }
    .add-btn, .btn {
      background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
      color: white;
      border: 2px double white;
      padding: 1rem 2rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin: 0.5rem 0;
    }
    .add-btn:hover, .btn:hover { background: linear-gradient(135deg, var(--secondary-color), var(--accent-color)); transform: scale(1.03); }
    .remove-btn {
      background: var(--error-color);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      position: absolute;
      left: 15px;
      bottom: 15px;
      transition: transform 0.3s ease;
    }
    .remove-btn:hover { transform: scale(1.1); }
    .total-box {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 2rem;
      border-radius: 15px;
      text-align: center;
      margin-top: 2rem;
      animation: pulse 2s infinite;
    }
    .legal-references {
      background: #f8f8f8;
      padding: 2rem;
      border-radius: 12px;
      margin-top: 3rem;
      border: 2px solid var(--accent-color);
    }
    /* الفوتر الفاخر */
    .footer {
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
      color: white;
      padding: 2rem;
      text-align: center;
      border-radius: 15px;
      margin-top: 3rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
    }
    .footer::before {
      content: "";
      position: absolute;
      top: -50px;
      left: 0;
      width: 100%;
      height: 150px;
      background: url('https://i.ibb.co/7n0Lzv0/footer-bg.png') no-repeat center;
      background-size: cover;
      opacity: 0.3;
      animation: float 5s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(20px); }
    }
    @media print {
      body { font-size: 12pt; background: white !important; }
      .header, .footer, button { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- الهيدر -->
    <div class="header">
      <h1>الإستمارة الذكية لتسجيل الأضرار والخسائر</h1>
      <h2>قطاع المقاولات اليمني - الاتحاد العام للمقاولين اليمنيين</h2>
      <div class="reference-number" id="fileNumber"></div>
      <div class="timestamp" id="currentDate"></div>
      <p>زوروا موقعنا: <a href="https://guyc-ye.com/" target="_blank">guyc-ye.com</a></p>
    </div>

    <!-- مقدمة تعريفية -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-info-circle"></i>
        <h2>مقدمة تعريفية</h2>
      </div>
      <div class="section-intro">
        <p>
          يُعد هذا النظام منصة شاملة لتوثيق وحساب كافة أنواع الأضرار والخسائر الناجمة عن الأزمات، الحروب والنزاعات المسلحة وفق المعايير الدولية وأفضل الممارسات العالمية. يساعد النظام المقاولين على إعداد ملف مطالبة متكامل، مدعومًا بالأدلة والمرجعيات القانونية.
        </p>
        <ul>
          <li><strong>الفئات المستهدفة:</strong> المقاولون، الشركات الإنشائية، الجهات الحكومية، منظمات المجتمع المدني.</li>
          <li><strong>أهمية النظام:</strong> توثيق شامل وحساب دقيق لتقديم ملف مطالبة متكامل وفاخر.</li>
          <li><strong>تنويه:</strong> تُستخدم البيانات للتقييم الأولي وقد تخضع للمراجعة من الجهات المختصة.</li>
        </ul>
      </div>
    </div>

    <!-- إعدادات العملة -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-coins"></i>
        <h2>إعدادات العملة</h2>
      </div>
      <div class="input-group">
        <label>سعر صرف الدولار (USD) مقابل الريال (YER):</label>
        <input type="number" id="exchangeRate" placeholder="أدخل سعر الصرف" required>
      </div>
    </div>

    <!-- البيانات الأساسية -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-building"></i>
        <h2>البيانات الأساسية</h2>
      </div>
      <div class="input-group">
        <label>اسم الشركة/المؤسسة:</label>
        <input type="text" id="companyName" placeholder="أدخل اسم الشركة" required>
      </div>
      <div class="input-group">
        <label>اسم المقاول المسؤول:</label>
        <input type="text" id="contractorName" placeholder="أدخل اسم المقاول" required>
      </div>
      <div class="input-group">
        <label>رقم الهاتف:</label>
        <input type="tel" id="phoneNumber" placeholder="أدخل رقم الهاتف" required>
      </div>
    </div>

    <!-- قسم الأضرار المباشرة -->
    <div class="section" id="sectionDirect">
      <div class="section-title">
        <i class="fas fa-exclamation-circle"></i>
        <h2>1. الأضرار والخسائر المباشرة</h2>
      </div>
      <div class="section-intro">
        <p>
          <strong>طريقة الحساب:</strong> تُحسب قيمة الضرر بضرب القيمة المدخلة بنسبة الضرر ومدة الضرر. <br>
          <strong>المرجع القانوني:</strong> معايير IVSC وRICS.
        </p>
      </div>
      <!-- بند أضرار الأصول الثابتة -->
      <h3>أ. أضرار الأصول الثابتة</h3>
      <div class="dynamic-list" id="fixedAssets">
        <div class="item-card">
          <input type="text" placeholder="مثال: مبنى رئيسي">
          <input type="number" placeholder="قيمة الضرر (ريال)" oninput="calcFixedAssets()">
          <select class="severity" oninput="calcFixedAssets()">
            <option value="1">استبدال كامل (100%)</option>
            <option value="0.7">إصلاح جزئي (70%)</option>
            <option value="0.3">إصلاح بسيط (30%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالسنوات)" oninput="calcFixedAssets()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcFixedAssets()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcFixedAssets()">حساب أضرار الأصول الثابتة</button>
      <div class="total-box" id="fixedAssetsTotalBox">
        <h4>الإجمالي: <span id="fixedAssetsTotal">0</span> ريال</h4>
      </div>

      <!-- بند الأضرار المادية للمخزون -->
      <h3>ب. الأضرار المادية للمخزون والمواد</h3>
      <div class="dynamic-list" id="inventoryDamage">
        <div class="item-card">
          <input type="text" placeholder="مثال: مواد خام">
          <input type="number" placeholder="قيمة الضرر (ريال)" oninput="calcInventoryDamage()">
          <select class="severity" oninput="calcInventoryDamage()">
            <option value="1">خسارة كاملة (100%)</option>
            <option value="0.5">خسارة جزئية (50%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالأشهر)" oninput="calcInventoryDamage()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcInventoryDamage()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcInventoryDamage()">حساب أضرار المخزون</button>
      <div class="total-box" id="inventoryDamageTotalBox">
        <h4>الإجمالي: <span id="inventoryDamageTotal">0</span> ريال</h4>
      </div>

      <!-- بند الأضرار المالية -->
      <h3>ج. الأضرار المالية والتدفقات النقدية</h3>
      <div class="dynamic-list" id="financialDirect">
        <div class="item-card">
          <input type="text" placeholder="مثال: خسارة إيرادات شهرية">
          <input type="number" placeholder="مقدار الخسارة (ريال)" oninput="calcFinancialDirect()">
          <input type="number" placeholder="مدة الضرر (بالأشهر)" oninput="calcFinancialDirect()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcFinancialDirect()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcFinancialDirect()">حساب الأضرار المالية</button>
      <div class="total-box" id="financialDirectTotalBox">
        <h4>الإجمالي: <span id="financialDirectTotal">0</span> ريال</h4>
      </div>

      <!-- بند الأضرار المؤسسية -->
      <h3>د. الأضرار المؤسسية</h3>
      <div class="dynamic-list" id="institutionalDamage">
        <div class="item-card">
          <input type="text" placeholder="مثال: فقدان موظف رئيسي">
          <input type="number" placeholder="قيمة الضرر (ريال)" oninput="calcInstitutionalDamage()">
          <select class="severity" oninput="calcInstitutionalDamage()">
            <option value="1">خسارة كاملة (100%)</option>
            <option value="0.5">خسارة جزئية (50%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالسنوات)" oninput="calcInstitutionalDamage()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcInstitutionalDamage()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcInstitutionalDamage()">حساب الأضرار المؤسسية</button>
      <div class="total-box" id="institutionalDamageTotalBox">
        <h4>الإجمالي: <span id="institutionalDamageTotal">0</span> ريال</h4>
      </div>
    </div>

    <!-- قسم الأضرار غير المباشرة -->
    <div class="section" id="sectionIndirect">
      <div class="section-title">
        <i class="fas fa-exclamation-triangle"></i>
        <h2>2. الأضرار والخسائر غير المباشرة</h2>
      </div>
      <div class="section-intro">
        <p>
          <strong>طريقة الحساب:</strong> تُحسب قيمة الضرر غير المباشر بضرب القيمة المدخلة بنسبة التأثير ومدة الضرر. <br>
          <strong>المرجع القانوني:</strong> معايير الأمم المتحدة لتقييم الأضرار.
        </p>
      </div>
      <!-- بند تعطيل الإنتاج والتأخير -->
      <h3>أ. تعطيل الإنتاج والتأخير</h3>
      <div class="dynamic-list" id="productionDelay">
        <div class="item-card">
          <input type="text" placeholder="مثال: توقف الإنتاج">
          <input type="number" placeholder="خسارة شهرية (ريال)" oninput="calcProductionDelay()">
          <input type="number" placeholder="مدة التأخير (بالأشهر)" oninput="calcProductionDelay()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcProductionDelay()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcProductionDelay()">حساب تعطيل الإنتاج</button>
      <div class="total-box" id="productionDelayTotalBox">
        <h4>الإجمالي: <span id="productionDelayTotal">0</span> ريال</h4>
      </div>

      <!-- بند خسارة القدرة التنافسية -->
      <h3>ب. خسارة القدرة التنافسية</h3>
      <div class="dynamic-list" id="competitiveLoss">
        <div class="item-card">
          <input type="text" placeholder="مثال: انخفاض حصص السوق">
          <input type="number" placeholder="خسارة شهرية (ريال)" oninput="calcCompetitiveLoss()">
          <input type="number" placeholder="مدة التأثير (بالأشهر)" oninput="calcCompetitiveLoss()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcCompetitiveLoss()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcCompetitiveLoss()">حساب خسارة القدرة التنافسية</button>
      <div class="total-box" id="competitiveLossTotalBox">
        <h4>الإجمالي: <span id="competitiveLossTotal">0</span> ريال</h4>
      </div>

      <!-- بند الضرر التكنولوجي أو البرمجي -->
      <h3>ج. الضرر التكنولوجي أو البرمجي</h3>
      <div class="dynamic-list" id="techDamage">
        <div class="item-card">
          <input type="text" placeholder="مثال: تعطل نظام معلومات">
          <input type="number" placeholder="تكلفة الإصلاح (ريال)" oninput="calcTechDamage()">
          <input type="number" placeholder="مدة التعطل (بالأشهر)" oninput="calcTechDamage()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcTechDamage()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcTechDamage()">حساب الضرر التكنولوجي</button>
      <div class="total-box" id="techDamageTotalBox">
        <h4>الإجمالي: <span id="techDamageTotal">0</span> ريال</h4>
      </div>

      <!-- بند الأضرار البيئية -->
      <h3>د. الأضرار البيئية</h3>
      <div class="dynamic-list" id="envDamage">
        <div class="item-card">
          <input type="text" placeholder="مثال: تلوث بيئي">
          <input type="number" placeholder="تكلفة الإصلاح (ريال)" oninput="calcEnvDamage()">
          <input type="number" placeholder="مدة الضرر (بالسنوات)" oninput="calcEnvDamage()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calcEnvDamage()">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calcEnvDamage()">حساب الأضرار البيئية</button>
      <div class="total-box" id="envDamageTotalBox">
        <h4>الإجمالي: <span id="envDamageTotal">0</span> ريال</h4>
      </div>
    </div>

    <!-- قسم خسائر تأخر دفع المستحقات -->
    <div class="section" id="sectionDelayed">
      <div class="section-title">
        <i class="fas fa-clock"></i>
        <h2>3. خسائر تأخر دفع المستحقات</h2>
      </div>
      <div class="section-intro">
        <p>
          <strong>طريقة الحساب:</strong> يتم حساب الخسائر بضرب المبلغ المتأخر في مدة التأخير (بالأشهر) مع احتساب الفائدة التراكمية بنسبة 5% سنوياً تقريبًا. <br>
          <strong>المرجع القانوني:</strong> معايير البنك الدولي والقوانين المحلية.
        </p>
      </div>
      <div class="dynamic-list" id="delayedPayments">
        <div class="item-card">
          <input type="text" placeholder="مثال: تأخر دفع مستحقات مشروع X">
          <input type="number" placeholder="المبلغ المتأخر (ريال)" oninput="calculateSectionTotal('delayedPayments','delayedTotalYER','delayedTotalUSD')">
          <input type="number" placeholder="مدة التأخير (بالأشهر)" oninput="calculateSectionTotal('delayedPayments','delayedTotalYER','delayedTotalUSD')">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calculateSectionTotal('delayedPayments','delayedTotalYER','delayedTotalUSD')">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calculateSectionTotal('delayedPayments','delayedTotalYER','delayedTotalUSD')">حساب خسائر تأخر الدفع</button>
      <div class="total-box" id="delayedTotalBox">
        <h4>الإجمالي: <span id="delayedTotalYER">0</span> ريال | <span id="delayedTotalUSD">0</span> USD</h4>
      </div>
    </div>

    <!-- قسم الأضرار الأخرى -->
    <div class="section" id="sectionOther">
      <div class="section-title">
        <i class="fas fa-ellipsis-h"></i>
        <h2>4. الأضرار الأخرى</h2>
      </div>
      <div class="section-intro">
        <p>
          أدخل بيانات أضرار إضافية لم تُدرج في الأقسام السابقة، مع تحديد الوصف، القيمة، مدة الضرر ونسبة التأثير.
        </p>
      </div>
      <div class="dynamic-list" id="otherDamages">
        <div class="item-card">
          <input type="text" placeholder="وصف الضرر">
          <input type="number" placeholder="المبلغ (ريال)" oninput="calculateSectionTotal('otherDamages','otherTotalYER','otherTotalUSD')">
          <input type="number" placeholder="مدة الضرر (بالأشهر/بالسنوات)" oninput="calculateSectionTotal('otherDamages','otherTotalYER','otherTotalUSD')">
          <select class="severity" oninput="calculateSectionTotal('otherDamages','otherTotalYER','otherTotalUSD')">
            <option value="1">تأثير كامل (100%)</option>
            <option value="0.5">تأثير جزئي (50%)</option>
          </select>
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
          <button class="remove-btn" onclick="this.parentElement.remove(); calculateSectionTotal('otherDamages','otherTotalYER','otherTotalUSD')">
            <i class="fas fa-times"></i> حذف
          </button>
        </div>
      </div>
      <button class="btn" onclick="calculateSectionTotal('otherDamages','otherTotalYER','otherTotalUSD')">حساب الأضرار الأخرى</button>
      <div class="total-box" id="otherTotalBox">
        <h4>الإجمالي: <span id="otherTotalYER">0</span> ريال | <span id="otherTotalUSD">0</span> USD</h4>
      </div>
    </div>

    <!-- قسم الخلاصة النهائية -->
    <div class="section" id="sectionFinal">
      <div class="section-title">
        <i class="fas fa-file-invoice-dollar"></i>
        <h2>5. الخلاصة النهائية</h2>
      </div>
      <div class="total-box" id="finalTotalBox">
        <p>الإجمالي المباشر: <span id="finalDirectTotal">0</span> ريال</p>
        <p>الإجمالي غير المباشر: <span id="finalIndirectTotal">0</span> ريال</p>
        <p>خسائر تأخر الدفع: <span id="finalDelayedTotal">0</span> ريال</p>
        <p>الأضرار الأخرى: <span id="finalOtherTotal">0</span> ريال</p>
        <p><strong>الإجمالي الكلي: <span id="grandTotal">0</span> ريال</strong></p>
      </div>
      <button class="btn" onclick="calculateFinalTotal()">
        <i class="fas fa-calculator"></i> حساب الإجمالي النهائي
      </button>
      <button class="btn" onclick="printForm()">
        <i class="fas fa-print"></i> طباعة النموذج
      </button>
      <button class="btn" onclick="exportToPDF()">
        <i class="fas fa-file-pdf"></i> تصدير إلى PDF
      </button>
      <button class="btn" onclick="shareForm()">
        <i class="fas fa-share"></i> مشاركة النموذج
      </button>
      <button class="btn" onclick="sendEmail()">
        <i class="fas fa-envelope"></i> إرسال النموذج للإيميل
      </button>
    </div>

    <!-- قسم المراجع القانونية والمعايير الدولية -->
    <div class="legal-references">
      <h3>6. المراجع القانونية والمعايير الدولية</h3>
      <ul>
        <li>مبادئ الأمم المتحدة بشأن التعويضات (القرار 60/147)</li>
        <li>دليل البنك الدولي لتقييم الأضرار (2021)</li>
        <li>المعايير المحاسبية الدولية (IFRS)</li>
        <li>دليل منظمة العمل الدولية (ILO) رقم 190</li>
        <li>بروتوكول لاهاي 1907</li>
      </ul>
    </div>

    <!-- قسم الخاتمة والتوصيات -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-thumbs-up"></i>
        <h2>7. الخاتمة والتوصيات</h2>
      </div>
      <div class="section-intro">
        <p>
          نشكرك على استخدام هذا النظام الشامل لحساب الأضرار والخسائر. تأكد من مراجعة وتحديث البيانات وتوثيق كافة الأدلة قبل تقديم ملف المطالبة. نوصي بالتواصل مع الجهات المختصة للحصول على التعويضات العادلة وفق المعايير الدولية.
        </p>
      </div>
    </div>

    <!-- قسم الإقرار والموافقة -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-check-circle"></i>
        <h2>8. الإقرار والموافقة</h2>
      </div>
      <div class="section-intro">
        <p>
          بموجب هذا، أقر بصحة البيانات والمعلومات المدخلة وأوافق على استخدامها لحساب الأضرار والخسائر، وأتعهد بتحمل المسؤولية القانونية عن دقتها.
        </p>
        <div class="input-group">
          <label>
            <input type="checkbox" id="agreement" required> أوافق على صحة البيانات المقدمة.
          </label>
        </div>
      </div>
    </div>

    <!-- الفوتر الفاخر -->
    <div class="footer">
      <p>© 2025 الاتحاد العام للمقاولين اليمنيين. جميع الحقوق محفوظة.</p>
      <p>الاتصال السريع: <a href="tel:01-450553" style="color: #FFD700; text-decoration: none;">01-450553</a></p>
      <p>البريد الإلكتروني: <a href="mailto:info@guyc-ye.com" style="color: #FFD700; text-decoration: none;">info@guyc-ye.com</a></p>
      <p>الموقع الإلكتروني: <a href="https://guyc-ye.com/" target="_blank" style="color: #FFD700; text-decoration: none;">https://guyc-ye.com/</a></p>
    </div>
  </div>

  <script>
    'use strict';
    const { jsPDF } = window.jspdf;

    // توليد رقم ملف فريد وتحديث التاريخ
    function generateFileNumber() {
      const timestamp = Date.now().toString().slice(-6);
      const randomNum = Math.floor(1000 + Math.random() * 9000);
      return `GUYC-${timestamp}-${randomNum}`;
    }
    function updateDateTime() {
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: 'numeric',
        minute: 'numeric',
        hour12: true 
      };
      document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ar-YE', options);
      document.getElementById('fileNumber').textContent = `رقم الملف: ${generateFileNumber()}`;
    }

    // دالة لإضافة بند جديد في قسم ديناميكي
    function addDamage(sectionId) {
      const templates = {
        directDamages: `
          <select class="damage-type">
            <option value="أضرار الأصول الثابتة">أضرار الأصول الثابتة<br>(المباني، المعدات، الأدوات)</option>
            <option value="أضرار المخزون">الأضرار المادية للمخزون والمواد</option>
            <option value="أضرار مالية">الأضرار المالية والتدفقات النقدية</option>
            <option value="أضرار مؤسسية">الأضرار المؤسسية<br>(فقدان الموظفين، إصابات العمل)</option>
          </select>
          <input type="text" placeholder="تفاصيل البند">
          <input type="number" placeholder="المبلغ" oninput="calculateSectionTotal('directDamages','directTotalYER','directTotalUSD')">
          <select class="severity" oninput="calculateSectionTotal('directDamages','directTotalYER','directTotalUSD')">
            <option value="1">استبدال كامل (100%)</option>
            <option value="0.7">إصلاح جزئي (70%)</option>
            <option value="0.3">إصلاح بسيط (30%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالسنوات)" oninput="calculateSectionTotal('directDamages','directTotalYER','directTotalUSD')">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `,
        indirectDamages: `
          <select class="damage-type">
            <option value="تعطيل الإنتاج">تعطيل الإنتاج والتأخير</option>
            <option value="خسارة تنافسية">خسارة القدرة التنافسية</option>
            <option value="ضرر تقني">الضرر التكنولوجي أو البرمجي</option>
            <option value="أضرار بيئية">الأضرار البيئية</option>
          </select>
          <input type="text" placeholder="تفاصيل البند">
          <input type="number" placeholder="المبلغ" oninput="calculateSectionTotal('indirectDamages','indirectTotalYER','indirectTotalUSD')">
          <select class="severity" oninput="calculateSectionTotal('indirectDamages','indirectTotalYER','indirectTotalUSD')">
            <option value="1">تأثير كامل (100%)</option>
            <option value="0.5">تأثير جزئي (50%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالأشهر)" oninput="calculateSectionTotal('indirectDamages','indirectTotalYER','indirectTotalUSD')">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `,
        compensations: `
          <select class="loss-type">
            <option value="تعويض مباشر">تعويض الأضرار المباشرة</option>
            <option value="تعويض غير مباشر">تعويض الأضرار غير المباشرة</option>
          </select>
          <input type="number" placeholder="المبلغ" oninput="calculateSectionTotal('compensations','compTotalYER','compTotalUSD')">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `,
        fixedAssets: `
          <input type="text" placeholder="مثال: مبنى رئيسي">
          <input type="number" placeholder="قيمة الضرر (ريال)" oninput="calcFixedAssets()">
          <select class="severity" oninput="calcFixedAssets()">
            <option value="1">استبدال كامل (100%)</option>
            <option value="0.7">إصلاح جزئي (70%)</option>
            <option value="0.3">إصلاح بسيط (30%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالسنوات)" oninput="calcFixedAssets()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `,
        inventoryDamage: `
          <input type="text" placeholder="مثال: مواد خام">
          <input type="number" placeholder="قيمة الضرر (ريال)" oninput="calcInventoryDamage()">
          <select class="severity" oninput="calcInventoryDamage()">
            <option value="1">خسارة كاملة (100%)</option>
            <option value="0.5">خسارة جزئية (50%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالأشهر)" oninput="calcInventoryDamage()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `,
        financialDirect: `
          <input type="text" placeholder="مثال: خسارة إيرادات شهرية">
          <input type="number" placeholder="مقدار الخسارة (ريال)" oninput="calcFinancialDirect()">
          <input type="number" placeholder="مدة الضرر (بالأشهر)" oninput="calcFinancialDirect()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `,
        institutionalDamage: `
          <input type="text" placeholder="مثال: فقدان موظف رئيسي">
          <input type="number" placeholder="قيمة الضرر (ريال)" oninput="calcInstitutionalDamage()">
          <select class="severity" oninput="calcInstitutionalDamage()">
            <option value="1">خسارة كاملة (100%)</option>
            <option value="0.5">خسارة جزئية (50%)</option>
          </select>
          <input type="number" placeholder="مدة الضرر (بالسنوات)" oninput="calcInstitutionalDamage()">
          <select class="currency">
            <option value="YER">ريال يمني</option>
            <option value="USD">دولار أمريكي</option>
          </select>
        `
      };
      let template = templates[sectionId];
      if (!template) { template = document.getElementById(sectionId).innerHTML; }
      const newItem = document.createElement('div');
      newItem.className = 'item-card';
      newItem.innerHTML = template + `<button class="remove-btn" onclick="this.parentElement.remove(); calculateSectionTotal('${sectionId}', '${getTotalId(sectionId, true)}', '${getTotalId(sectionId, false)}')"><i class="fas fa-times"></i> حذف</button>`;
      document.getElementById(sectionId).appendChild(newItem);
    }
    function getTotalId(sectionId, isYER) {
      if(sectionId === 'directDamages') return isYER ? 'directTotalYER' : 'directTotalUSD';
      if(sectionId === 'indirectDamages') return isYER ? 'indirectTotalYER' : 'indirectTotalUSD';
      if(sectionId === 'compensations') return isYER ? 'compTotalYER' : 'compTotalUSD';
      if(sectionId === 'fixedAssets') return isYER ? 'fixedAssetsTotal' : 'fixedAssetsTotalUSD';
      if(sectionId === 'inventoryDamage') return isYER ? 'inventoryDamageTotal' : 'inventoryDamageTotalUSD';
      if(sectionId === 'financialDirect') return isYER ? 'financialDirectTotal' : 'financialDirectTotalUSD';
      if(sectionId === 'institutionalDamage') return isYER ? 'institutionalDamageTotal' : 'institutionalDamageTotalUSD';
      if(sectionId === 'delayedPayments') return isYER ? 'delayedTotalYER' : 'delayedTotalUSD';
      if(sectionId === 'otherDamages') return isYER ? 'otherTotalYER' : 'otherTotalUSD';
      return isYER ? sectionId + "TotalYER" : sectionId + "TotalUSD";
    }

    // دوال حساب خاصة بكل قسم:
    function calcFixedAssets() {
      let total = 0;
      document.querySelectorAll('#fixedAssets .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const severity = parseFloat(item.querySelector('.severity')?.value) || 1;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة الضرر"]')?.value) || 1;
        total += value * severity * duration;
      });
      document.getElementById('fixedAssetsTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcInventoryDamage() {
      let total = 0;
      document.querySelectorAll('#inventoryDamage .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const severity = parseFloat(item.querySelector('.severity')?.value) || 1;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة الضرر"]')?.value) || 1;
        total += value * severity * duration;
      });
      document.getElementById('inventoryDamageTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcFinancialDirect() {
      let total = 0;
      document.querySelectorAll('#financialDirect .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة الضرر"]')?.value) || 1;
        total += value * duration;
      });
      document.getElementById('financialDirectTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcInstitutionalDamage() {
      let total = 0;
      document.querySelectorAll('#institutionalDamage .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const severity = parseFloat(item.querySelector('.severity')?.value) || 1;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة الضرر"]')?.value) || 1;
        total += value * severity * duration;
      });
      document.getElementById('institutionalDamageTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcProductionDelay() {
      let total = 0;
      document.querySelectorAll('#productionDelay .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة التأخير"]')?.value) || 1;
        total += value * duration;
      });
      document.getElementById('productionDelayTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcCompetitiveLoss() {
      let total = 0;
      document.querySelectorAll('#competitiveLoss .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة التأثير"]')?.value) || 1;
        total += value * duration;
      });
      document.getElementById('competitiveLossTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcTechDamage() {
      let total = 0;
      document.querySelectorAll('#techDamage .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة التعطل"]')?.value) || 1;
        total += value * duration;
      });
      document.getElementById('techDamageTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }
    function calcEnvDamage() {
      let total = 0;
      document.querySelectorAll('#envDamage .item-card').forEach(item => {
        const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
        const duration = parseFloat(item.querySelector('input[placeholder*="مدة الضرر"]')?.value) || 1;
        total += value * duration;
      });
      document.getElementById('envDamageTotal').textContent = total.toLocaleString('ar-YE') + " ريال";
    }

    // دالة حساب الإجمالي النهائي لجميع الأقسام
    function calculateFinalTotal() {
      const direct = parseFloat(document.getElementById('directTotalYER').textContent) || 0;
      const indirect = parseFloat(document.getElementById('indirectTotalYER').textContent) || 0;
      const delayed = document.getElementById('delayedTotalYER') ? parseFloat(document.getElementById('delayedTotalYER').textContent) || 0 : 0;
      const other = document.getElementById('otherTotalYER') ? parseFloat(document.getElementById('otherTotalYER').textContent) || 0 : 0;
      const grand = direct + indirect + delayed + other;
      document.getElementById('finalDirectTotal').textContent = direct.toLocaleString('ar-YE');
      document.getElementById('finalIndirectTotal').textContent = indirect.toLocaleString('ar-YE');
      if(document.getElementById('delayedTotalYER'))
        document.getElementById('finalDelayedTotal').textContent = delayed.toLocaleString('ar-YE');
      if(document.getElementById('otherTotalYER'))
        document.getElementById('finalOtherTotal').textContent = other.toLocaleString('ar-YE');
      document.getElementById('grandTotal').textContent = grand.toLocaleString('ar-YE');
    }

    // وظائف إضافية للطباعة والتصدير والمشاركة
    function printForm() {
      window.print();
    }
    function exportToPDF() {
      const doc = new jsPDF();
      doc.text("الإجمالي النهائي للتعويضات:", 10, 10);
      doc.text(`بالريال: ${document.getElementById('grandTotal').textContent}`, 10, 20);
      doc.save("الإجمالي_النهائي.pdf");
    }
    function shareForm() {
      if(navigator.share) {
        navigator.share({
          title: 'الإجمالي النهائي للتعويضات',
          text: `الإجمالي: ${document.getElementById('grandTotal').textContent} ريال`,
          url: window.location.href
        }).then(() => {
          console.log('تمت المشاركة بنجاح');
        }).catch((error) => {
          console.error('حدث خطأ أثناء المشاركة:', error);
        });
      } else { alert('المشاركة غير مدعومة في هذا المتصفح.'); }
    }
    function sendEmail() {
      const subject = encodeURIComponent("ملف التعويضات - الاتحاد العام للمقاولين اليمنيين");
      const body = encodeURIComponent(`مرحباً،
      
يرجى الاطلاع على ملف التعويضات النهائي:

الإجمالي: ${document.getElementById('grandTotal').textContent} ريال

مع تحيات فريق الاتحاد العام للمقاولين اليمنيين.`);
      window.location.href = `mailto:info@guyc-ye.com?subject=${subject}&body=${body}`;
    }
    
    // التهيئة الأولية عند تحميل الصفحة
    window.addEventListener('load', () => {
      updateDateTime();
      setInterval(updateDateTime, 60000);
    });
  </script>
</body>
</html>
